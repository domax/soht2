@startuml
'https://plantuml.com/sequence-diagram
title Sequence Diagram for Client-Server SOHT Communication

'autonumber
activate "SOHT Client"

"SOHT Client" -> "SOHT Server" ++: open target
"SOHT Server" -> "Target Socket" **: open
"SOHT Server" --> "SOHT Client" --: done

"SOHT Client" -> "Client Socket" **: open

alt exchange

  loop while not closed

    "SOHT Client" -> "Client Socket" ++: read buffer
    note left of "Client Socket": reads to buffer with timeout
    "SOHT Client" <-- "Client Socket" --: return data1

    "SOHT Client" -> "SOHT Server" ++: exchange data1

    "SOHT Server" -> "Target Socket" ++: write data1
    note right of "Target Socket": optional - if data1 isn't empty
    "SOHT Server" <-- "Target Socket" --: done

    "SOHT Server" -> "Target Socket" ++: read buffer
    note right of "Target Socket": reads to buffer with timeout
    "SOHT Server" <-- "Target Socket" --: return data2

    "SOHT Client" <-- "SOHT Server" --: return data2

    "SOHT Client" -> "Client Socket" ++: write data2
    note left of "Client Socket": optional - if data2 isn't empty
    "SOHT Client" <-- "Client Socket" --: done

    "SOHT Client" -> "SOHT Client": delay
    note right: computed from 0 to maxPollingDelay

  end loop

else close

  "SOHT Client" -> "Client Socket" !!: close

  "SOHT Client" -> "SOHT Server" ++: close
  "SOHT Server" -> "Target Socket" !!: close
  "SOHT Client" <-- "SOHT Server" --: done

end alt

@enduml